<%= simple_form_for [loan, transfer] do |f| %>

  <% if (loan.collateral_currency == 'EUR' && current_user.euro_balance < loan.collateral_cents) || (loan.collateral_currency == 'ETH' && current_user.crypto_balance < loan.collateral_cents) %>
    <p class='alert alert-warning'>Vous ne pouvez pas utiliser votre portefeuille <%= @loan.collateral_currency %> pour payer la garantie, parce que vous n'avez pas assez d'argent dessus ( <%= loan.collateral_currency == 'EUR' ? "#{Loan.convert_amount(current_user.euro_balance, 'EUR')} euros " : "#{Loan.convert_amount(current_user.crypto_balance, 'ETH')} ethereum "%>). Vous devez utiliser un autre moyen de paiement.</p>
    <%= f.hidden_field :payment_mean, value: @loan.collateral_currency == "EUR" ? "card" : "crypto" %>

  <% elsif loan.collateral_currency == 'EUR' %>
    <p class= 'mb-0'><%= "Le solde actuel de votre portefeuille EURO est suffisant pour verser la garantie, il s'élève à #{Loan.convert_amount(current_user.euro_balance, 'EUR')} euros. Voulez-vous alors utiliser votre portefeuille EURO pour verser la garantie ?" %></p>
    <%= f.input :payment_mean, as: :radio_buttons, collection: [['euro_wallet', 'Oui'], ['card', 'Non']], label_method: :second, value_method: :first, class: 'payment_button', label: "" %>

  <% elsif loan.collateral_currency == 'ETH' %>
    <p class= 'mb-0'><%= "Le solde actuel de votre portefeuille CRYPTO est suffisant pour verser la garantie, il s'élève à #{Loan.convert_amount(current_user.crypto_balance, 'ETH')} ethereum. Voulez-vous alors utiliser votre portefeuille CRYPTO pour verser la garantie ?" %></p>
    <%= f.input :payment_mean, as: :radio_buttons, collection: [['crypto_wallet', 'Oui'], ['crypto', 'Non']], label_method: :second, value_method: :first, class: 'payment_button', label: "" %>

  <% end %>

  <div class="d-flex align-items-center justify-content-center mt-4">
    <i class="fas fa-exclamation-triangle mr-4 h2 text-danger"></i>
    <p class='h6 mb-0'>Vous êtes sur le point de payer une garantie d'un montant de <%= Loan.convert_amount(@loan.collateral_cents, @loan.collateral_currency) %> <%= @loan.collateral_currency %>. Une fois le paiement effectué, votre emprunt sera validé et débutera. Vous recevrez ensuite : <%= Loan.convert_amount(@loan.amount_cents, @loan.amount_currency) %> <%= @loan.amount_currency %> (montant de votre emprunt) sur votre portefeuille <%= @loan.amount_currency %>.</p>
  </div>

  <div class="d-flex align-items-center mt-5">
    <%= f.button :submit, 'Verser la garantie', class:'btn btn-success w-100 text-center' %>
  </div>

<% end %>
